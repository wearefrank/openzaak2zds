<Adapter name="ReplaceZaakIdentificatie">
    <Receiver>
        <JavaListener name="ReplaceZaakIdentificatie"/>
    </Receiver>

    <Pipeline>
        <Exits>
            <Exit name="Exit" state="SUCCESS" />
            <Exit name="BadRequest" state="ERROR" code="400" />
            <Exit name="NotAuthorized" state="ERROR" code="401" />
            <Exit name="Forbidden" state="ERROR" code="403" />
            <Exit name="NotFound" state="ERROR" code="404" />
            <Exit name="NotAcceptable" state="ERROR" code="406" />
            <Exit name="UnsupportedMediaType" state="ERROR" code="415" />
            <Exit name="TooManyRequest" state="ERROR" code="429" />
            <Exit name="ServerError" state="ERROR" code="500" />
            <Exit name="ServiceUnavailable" state="ERROR" code="503" />
        </Exits>

        <UUIDGeneratorPipe name="GenerateReferentienummer"
                           preserveInput="true"
                           storeResultInSessionKey="Referentienummer">
            <Forward name="success" path="CreateStuurgegevens" />
        </UUIDGeneratorPipe>

        <XsltPipe name="CreateStuurgegevens"
                  styleSheetName="Common/xsl/CreateStuurgegevens.xslt"
                  storeResultInSessionKey="Stuurgegevens">
            <Param name="BerichtCode" value="Di02" />
            <Param name="ZenderOrganisatie" value="${openforms2zds.workflows.stuurgegevens.zender.organisatie}" />
            <Param name="ZenderApplicatie" value="${openforms2zds.workflows.stuurgegevens.zender.applicatie}" />
            <Param name="OntvangerOrganisatie" value="${openforms2zds.workflows.stuurgegevens.ontvanger.organisatie}" />
            <Param name="OntvangerApplicatie" value="${openforms2zds.workflows.stuurgegevens.ontvanger.applicatie}" />
            <Param name="Referentienummer" sessionKey="Referentienummer" />
            <Param name="Functie" value="genereerDocumentidentificatie" />
            <Forward name="success" path="CallCreateZaakIdentificatie" />
        </XsltPipe>

        <!-- Create genereerDocumentIdentificatie message -->
        <SenderPipe name="CallCreateZaakIdentificatie"
                getInputFromFixedValue="&lt;EmptyInput/&gt;">
            <IbisLocalSender name="CallCreateZaakIdentificatieSender"
                    javaListener="CallCreateZaakIdentificatie"
                    returnedSessionKeys="Error">
                <Param name="Stuurgegevens" sessionKey="Stuurgegevens"/>
            </IbisLocalSender>
            <Forward name="success" path="StoreZaakIdentificatie" />
        </SenderPipe>

        <PutInSessionPipe name="StoreZaakIdentificatie">
            <Param name="ZaakIdentificatie" xpathExpression="//zaak/identificatie" />
            <Forward name="success" path="UseZaakIdentificatie" />
        </PutInSessionPipe>

        <XsltPipe name="UseZaakIdentificatie" getInputFromSessionKey="originalMessage" styleSheetName="Common/xsl/insertZaakIdentificatie.xsl">
            <Param name="zaakIdentificatie" sessionKey="ZaakIdentificatie"/>
        </XsltPipe>

        <SenderPipe name="SendToZaakbrug">
            <EchoSender name="EchoSender"/>
        </SenderPipe>
    </Pipeline>
</Adapter>